
%.ll: ${BMARK}.cu
	clang -Xclang -disable-O0-optnone -S -emit-llvm -g $<

${BMARK}_linked.bc: ${BMARK}-cuda-nvptx64-nvidia-cuda-sm_20.ll ${BMARK}.ll
	llvm-link ${BMARK}-cuda-nvptx64-nvidia-cuda-sm_20.ll ${BMARK}.ll -o ${BMARK}_linked.bc

${BMARK}_cpu.bc: ${BMARK}_linked.bc
	opt -load ~/noelle-workspace/CudaFE/build/MergeKernel/libLLVMCudaFE.so -merge-kernel -mem2reg ${BMARK}_linked.bc -o ${BMARK}_cpu.bc

${BMARK}_cpu.cbe.c: ${BMARK}_cpu.bc
	splendid ${BMARK}_cpu.bc 2> debug

parallel.exe: ${BMARK}_cpu.cbe.c
	clang -fopenmp -O3 $< -o $@

cpu.exe: ${BMARK}_cpu.bc
	clang -O3 $< -o $@

seq.exe: ${BMARK}.c
	clang -O3 $< -o $@

clean:
	rm -rf *.ll *.bc *.cbe.c *.exe debug
